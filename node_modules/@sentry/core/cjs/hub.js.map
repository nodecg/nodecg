{"version":3,"file":"hub.js","sources":["../../src/hub.ts"],"sourcesContent":["/* eslint-disable max-lines */\nimport type {\n  Breadcrumb,\n  BreadcrumbHint,\n  Client,\n  CustomSamplingContext,\n  Event,\n  EventHint,\n  Extra,\n  Extras,\n  Hub as HubInterface,\n  Integration,\n  IntegrationClass,\n  Primitive,\n  Session,\n  SessionContext,\n  Severity,\n  SeverityLevel,\n  Transaction,\n  TransactionContext,\n  User,\n} from '@sentry/types';\nimport { GLOBAL_OBJ, consoleSandbox, dateTimestampInSeconds, getGlobalSingleton, logger, uuid4 } from '@sentry/utils';\n\nimport { DEFAULT_ENVIRONMENT } from './constants';\nimport { DEBUG_BUILD } from './debug-build';\nimport { Scope } from './scope';\nimport { closeSession, makeSession, updateSession } from './session';\nimport { SDK_VERSION } from './version';\n\n/**\n * API compatibility version of this hub.\n *\n * WARNING: This number should only be increased when the global interface\n * changes and new methods are introduced.\n *\n * @hidden\n */\nexport const API_VERSION = parseFloat(SDK_VERSION);\n\n/**\n * Default maximum number of breadcrumbs added to an event. Can be overwritten\n * with {@link Options.maxBreadcrumbs}.\n */\nconst DEFAULT_BREADCRUMBS = 100;\n\nexport interface RunWithAsyncContextOptions {\n  /** Whether to reuse an existing async context if one exists. Defaults to false. */\n  reuseExisting?: boolean;\n}\n\n/**\n * @private Private API with no semver guarantees!\n *\n * Strategy used to track async context.\n */\nexport interface AsyncContextStrategy {\n  /**\n   * Gets the current async context. Returns undefined if there is no current async context.\n   */\n  getCurrentHub: () => Hub | undefined;\n  /**\n   * Runs the supplied callback in its own async context.\n   */\n  runWithAsyncContext<T>(callback: () => T, options: RunWithAsyncContextOptions): T;\n}\n\n/**\n * A layer in the process stack.\n * @hidden\n */\nexport interface Layer {\n  client?: Client;\n  scope: Scope;\n}\n\n/**\n * An object that contains a hub and maintains a scope stack.\n * @hidden\n */\nexport interface Carrier {\n  __SENTRY__?: {\n    hub?: Hub;\n    acs?: AsyncContextStrategy;\n    /**\n     * Extra Hub properties injected by various SDKs\n     */\n    integrations?: Integration[];\n    extensions?: {\n      /** Extension methods for the hub, which are bound to the current Hub instance */\n      // eslint-disable-next-line @typescript-eslint/ban-types\n      [key: string]: Function;\n    };\n  };\n}\n\n/**\n * @inheritDoc\n */\nexport class Hub implements HubInterface {\n  /** Is a {@link Layer}[] containing the client and scope */\n  private readonly _stack: Layer[];\n\n  /** Contains the last event id of a captured event.  */\n  private _lastEventId?: string;\n\n  private _isolationScope: Scope;\n\n  /**\n   * Creates a new instance of the hub, will push one {@link Layer} into the\n   * internal stack on creation.\n   *\n   * @param client bound to the hub.\n   * @param scope bound to the hub.\n   * @param version number, higher number means higher priority.\n   */\n  public constructor(\n    client?: Client,\n    scope: Scope = new Scope(),\n    isolationScope = new Scope(),\n    private readonly _version: number = API_VERSION,\n  ) {\n    this._stack = [{ scope }];\n    if (client) {\n      this.bindClient(client);\n    }\n\n    this._isolationScope = isolationScope;\n  }\n\n  /**\n   * @inheritDoc\n   */\n  public isOlderThan(version: number): boolean {\n    return this._version < version;\n  }\n\n  /**\n   * @inheritDoc\n   */\n  public bindClient(client?: Client): void {\n    const top = this.getStackTop();\n    top.client = client;\n    if (client && client.setupIntegrations) {\n      client.setupIntegrations();\n    }\n  }\n\n  /**\n   * @inheritDoc\n   *\n   * @deprecated Use `withScope` instead.\n   */\n  public pushScope(): Scope {\n    // We want to clone the content of prev scope\n    const scope = this.getScope().clone();\n    this.getStack().push({\n      client: this.getClient(),\n      scope,\n    });\n    return scope;\n  }\n\n  /**\n   * @inheritDoc\n   *\n   * @deprecated Use `withScope` instead.\n   */\n  public popScope(): boolean {\n    if (this.getStack().length <= 1) return false;\n    return !!this.getStack().pop();\n  }\n\n  /**\n   * @inheritDoc\n   */\n  public withScope<T>(callback: (scope: Scope) => T): T {\n    // eslint-disable-next-line deprecation/deprecation\n    const scope = this.pushScope();\n    try {\n      return callback(scope);\n    } finally {\n      // eslint-disable-next-line deprecation/deprecation\n      this.popScope();\n    }\n  }\n\n  /**\n   * @inheritDoc\n   */\n  public getClient<C extends Client>(): C | undefined {\n    return this.getStackTop().client as C;\n  }\n\n  /** Returns the scope of the top stack. */\n  public getScope(): Scope {\n    return this.getStackTop().scope;\n  }\n\n  /** @inheritdoc */\n  public getIsolationScope(): Scope {\n    return this._isolationScope;\n  }\n\n  /** Returns the scope stack for domains or the process. */\n  public getStack(): Layer[] {\n    return this._stack;\n  }\n\n  /** Returns the topmost scope layer in the order domain > local > process. */\n  public getStackTop(): Layer {\n    return this._stack[this._stack.length - 1];\n  }\n\n  /**\n   * @inheritDoc\n   */\n  public captureException(exception: unknown, hint?: EventHint): string {\n    const eventId = (this._lastEventId = hint && hint.event_id ? hint.event_id : uuid4());\n    const syntheticException = new Error('Sentry syntheticException');\n    this._withClient((client, scope) => {\n      client.captureException(\n        exception,\n        {\n          originalException: exception,\n          syntheticException,\n          ...hint,\n          event_id: eventId,\n        },\n        scope,\n      );\n    });\n    return eventId;\n  }\n\n  /**\n   * @inheritDoc\n   */\n  public captureMessage(\n    message: string,\n    // eslint-disable-next-line deprecation/deprecation\n    level?: Severity | SeverityLevel,\n    hint?: EventHint,\n  ): string {\n    const eventId = (this._lastEventId = hint && hint.event_id ? hint.event_id : uuid4());\n    const syntheticException = new Error(message);\n    this._withClient((client, scope) => {\n      client.captureMessage(\n        message,\n        level,\n        {\n          originalException: message,\n          syntheticException,\n          ...hint,\n          event_id: eventId,\n        },\n        scope,\n      );\n    });\n    return eventId;\n  }\n\n  /**\n   * @inheritDoc\n   */\n  public captureEvent(event: Event, hint?: EventHint): string {\n    const eventId = hint && hint.event_id ? hint.event_id : uuid4();\n    if (!event.type) {\n      this._lastEventId = eventId;\n    }\n\n    this._withClient((client, scope) => {\n      client.captureEvent(event, { ...hint, event_id: eventId }, scope);\n    });\n    return eventId;\n  }\n\n  /**\n   * @inheritDoc\n   */\n  public lastEventId(): string | undefined {\n    return this._lastEventId;\n  }\n\n  /**\n   * @inheritDoc\n   */\n  public addBreadcrumb(breadcrumb: Breadcrumb, hint?: BreadcrumbHint): void {\n    const { scope, client } = this.getStackTop();\n\n    if (!client) return;\n\n    const { beforeBreadcrumb = null, maxBreadcrumbs = DEFAULT_BREADCRUMBS } =\n      (client.getOptions && client.getOptions()) || {};\n\n    if (maxBreadcrumbs <= 0) return;\n\n    const timestamp = dateTimestampInSeconds();\n    const mergedBreadcrumb = { timestamp, ...breadcrumb };\n    const finalBreadcrumb = beforeBreadcrumb\n      ? (consoleSandbox(() => beforeBreadcrumb(mergedBreadcrumb, hint)) as Breadcrumb | null)\n      : mergedBreadcrumb;\n\n    if (finalBreadcrumb === null) return;\n\n    if (client.emit) {\n      client.emit('beforeAddBreadcrumb', finalBreadcrumb, hint);\n    }\n\n    scope.addBreadcrumb(finalBreadcrumb, maxBreadcrumbs);\n  }\n\n  /**\n   * @inheritDoc\n   */\n  public setUser(user: User | null): void {\n    this.getScope().setUser(user);\n  }\n\n  /**\n   * @inheritDoc\n   */\n  public setTags(tags: { [key: string]: Primitive }): void {\n    this.getScope().setTags(tags);\n  }\n\n  /**\n   * @inheritDoc\n   */\n  public setExtras(extras: Extras): void {\n    this.getScope().setExtras(extras);\n  }\n\n  /**\n   * @inheritDoc\n   */\n  public setTag(key: string, value: Primitive): void {\n    this.getScope().setTag(key, value);\n  }\n\n  /**\n   * @inheritDoc\n   */\n  public setExtra(key: string, extra: Extra): void {\n    this.getScope().setExtra(key, extra);\n  }\n\n  /**\n   * @inheritDoc\n   */\n  // eslint-disable-next-line @typescript-eslint/no-explicit-any\n  public setContext(name: string, context: { [key: string]: any } | null): void {\n    this.getScope().setContext(name, context);\n  }\n\n  /**\n   * @inheritDoc\n   *\n   * @deprecated Use `getScope()` directly.\n   */\n  public configureScope(callback: (scope: Scope) => void): void {\n    const { scope, client } = this.getStackTop();\n    if (client) {\n      callback(scope);\n    }\n  }\n\n  /**\n   * @inheritDoc\n   */\n  public run(callback: (hub: Hub) => void): void {\n    const oldHub = makeMain(this);\n    try {\n      callback(this);\n    } finally {\n      makeMain(oldHub);\n    }\n  }\n\n  /**\n   * @inheritDoc\n   */\n  public getIntegration<T extends Integration>(integration: IntegrationClass<T>): T | null {\n    const client = this.getClient();\n    if (!client) return null;\n    try {\n      return client.getIntegration(integration);\n    } catch (_oO) {\n      DEBUG_BUILD && logger.warn(`Cannot retrieve integration ${integration.id} from the current Hub`);\n      return null;\n    }\n  }\n\n  /**\n   * @inheritDoc\n   */\n  public startTransaction(context: TransactionContext, customSamplingContext?: CustomSamplingContext): Transaction {\n    const result = this._callExtensionMethod<Transaction>('startTransaction', context, customSamplingContext);\n\n    if (DEBUG_BUILD && !result) {\n      const client = this.getClient();\n      if (!client) {\n        logger.warn(\n          \"Tracing extension 'startTransaction' is missing. You should 'init' the SDK before calling 'startTransaction'\",\n        );\n      } else {\n        logger.warn(`Tracing extension 'startTransaction' has not been added. Call 'addTracingExtensions' before calling 'init':\nSentry.addTracingExtensions();\nSentry.init({...});\n`);\n      }\n    }\n\n    return result;\n  }\n\n  /**\n   * @inheritDoc\n   */\n  public traceHeaders(): { [key: string]: string } {\n    return this._callExtensionMethod<{ [key: string]: string }>('traceHeaders');\n  }\n\n  /**\n   * @inheritDoc\n   */\n  public captureSession(endSession: boolean = false): void {\n    // both send the update and pull the session from the scope\n    if (endSession) {\n      return this.endSession();\n    }\n\n    // only send the update\n    this._sendSessionUpdate();\n  }\n\n  /**\n   * @inheritDoc\n   */\n  public endSession(): void {\n    const layer = this.getStackTop();\n    const scope = layer.scope;\n    const session = scope.getSession();\n    if (session) {\n      closeSession(session);\n    }\n    this._sendSessionUpdate();\n\n    // the session is over; take it off of the scope\n    scope.setSession();\n  }\n\n  /**\n   * @inheritDoc\n   */\n  public startSession(context?: SessionContext): Session {\n    const { scope, client } = this.getStackTop();\n    const { release, environment = DEFAULT_ENVIRONMENT } = (client && client.getOptions()) || {};\n\n    // Will fetch userAgent if called from browser sdk\n    const { userAgent } = GLOBAL_OBJ.navigator || {};\n\n    const session = makeSession({\n      release,\n      environment,\n      user: scope.getUser(),\n      ...(userAgent && { userAgent }),\n      ...context,\n    });\n\n    // End existing session if there's one\n    const currentSession = scope.getSession && scope.getSession();\n    if (currentSession && currentSession.status === 'ok') {\n      updateSession(currentSession, { status: 'exited' });\n    }\n    this.endSession();\n\n    // Afterwards we set the new session on the scope\n    scope.setSession(session);\n\n    return session;\n  }\n\n  /**\n   * Returns if default PII should be sent to Sentry and propagated in ourgoing requests\n   * when Tracing is used.\n   */\n  public shouldSendDefaultPii(): boolean {\n    const client = this.getClient();\n    const options = client && client.getOptions();\n    return Boolean(options && options.sendDefaultPii);\n  }\n\n  /**\n   * Sends the current Session on the scope\n   */\n  private _sendSessionUpdate(): void {\n    const { scope, client } = this.getStackTop();\n\n    const session = scope.getSession();\n    if (session && client && client.captureSession) {\n      client.captureSession(session);\n    }\n  }\n\n  /**\n   * Internal helper function to call a method on the top client if it exists.\n   *\n   * @param method The method to call on the client.\n   * @param args Arguments to pass to the client function.\n   */\n  private _withClient(callback: (client: Client, scope: Scope) => void): void {\n    const { scope, client } = this.getStackTop();\n    if (client) {\n      callback(client, scope);\n    }\n  }\n\n  /**\n   * Calls global extension method and binding current instance to the function call\n   */\n  // @ts-expect-error Function lacks ending return statement and return type does not include 'undefined'. ts(2366)\n  // eslint-disable-next-line @typescript-eslint/no-explicit-any\n  private _callExtensionMethod<T>(method: string, ...args: any[]): T {\n    const carrier = getMainCarrier();\n    const sentry = carrier.__SENTRY__;\n    if (sentry && sentry.extensions && typeof sentry.extensions[method] === 'function') {\n      return sentry.extensions[method].apply(this, args);\n    }\n    DEBUG_BUILD && logger.warn(`Extension method ${method} couldn't be found, doing nothing.`);\n  }\n}\n\n/**\n * Returns the global shim registry.\n *\n * FIXME: This function is problematic, because despite always returning a valid Carrier,\n * it has an optional `__SENTRY__` property, which then in turn requires us to always perform an unnecessary check\n * at the call-site. We always access the carrier through this function, so we can guarantee that `__SENTRY__` is there.\n **/\nexport function getMainCarrier(): Carrier {\n  GLOBAL_OBJ.__SENTRY__ = GLOBAL_OBJ.__SENTRY__ || {\n    extensions: {},\n    hub: undefined,\n  };\n  return GLOBAL_OBJ;\n}\n\n/**\n * Replaces the current main hub with the passed one on the global object\n *\n * @returns The old replaced hub\n */\nexport function makeMain(hub: Hub): Hub {\n  const registry = getMainCarrier();\n  const oldHub = getHubFromCarrier(registry);\n  setHubOnCarrier(registry, hub);\n  return oldHub;\n}\n\n/**\n * Returns the default hub instance.\n *\n * If a hub is already registered in the global carrier but this module\n * contains a more recent version, it replaces the registered version.\n * Otherwise, the currently registered hub will be returned.\n */\nexport function getCurrentHub(): Hub {\n  // Get main carrier (global for every environment)\n  const registry = getMainCarrier();\n\n  if (registry.__SENTRY__ && registry.__SENTRY__.acs) {\n    const hub = registry.__SENTRY__.acs.getCurrentHub();\n\n    if (hub) {\n      return hub;\n    }\n  }\n\n  // Return hub that lives on a global object\n  return getGlobalHub(registry);\n}\n\n/**\n * Get the currently active isolation scope.\n * The isolation scope is active for the current exection context,\n * meaning that it will remain stable for the same Hub.\n */\nexport function getIsolationScope(): Scope {\n  return getCurrentHub().getIsolationScope();\n}\n\nfunction getGlobalHub(registry: Carrier = getMainCarrier()): Hub {\n  // If there's no hub, or its an old API, assign a new one\n  if (!hasHubOnCarrier(registry) || getHubFromCarrier(registry).isOlderThan(API_VERSION)) {\n    setHubOnCarrier(registry, new Hub());\n  }\n\n  // Return hub that lives on a global object\n  return getHubFromCarrier(registry);\n}\n\n/**\n * @private Private API with no semver guarantees!\n *\n * If the carrier does not contain a hub, a new hub is created with the global hub client and scope.\n */\nexport function ensureHubOnCarrier(carrier: Carrier, parent: Hub = getGlobalHub()): void {\n  // If there's no hub on current domain, or it's an old API, assign a new one\n  if (!hasHubOnCarrier(carrier) || getHubFromCarrier(carrier).isOlderThan(API_VERSION)) {\n    const client = parent.getClient();\n    const scope = parent.getScope();\n    const isolationScope = parent.getIsolationScope();\n    setHubOnCarrier(carrier, new Hub(client, scope.clone(), isolationScope.clone()));\n  }\n}\n\n/**\n * @private Private API with no semver guarantees!\n *\n * Sets the global async context strategy\n */\nexport function setAsyncContextStrategy(strategy: AsyncContextStrategy | undefined): void {\n  // Get main carrier (global for every environment)\n  const registry = getMainCarrier();\n  registry.__SENTRY__ = registry.__SENTRY__ || {};\n  registry.__SENTRY__.acs = strategy;\n}\n\n/**\n * Runs the supplied callback in its own async context. Async Context strategies are defined per SDK.\n *\n * @param callback The callback to run in its own async context\n * @param options Options to pass to the async context strategy\n * @returns The result of the callback\n */\nexport function runWithAsyncContext<T>(callback: () => T, options: RunWithAsyncContextOptions = {}): T {\n  const registry = getMainCarrier();\n\n  if (registry.__SENTRY__ && registry.__SENTRY__.acs) {\n    return registry.__SENTRY__.acs.runWithAsyncContext(callback, options);\n  }\n\n  // if there was no strategy, fallback to just calling the callback\n  return callback();\n}\n\n/**\n * This will tell whether a carrier has a hub on it or not\n * @param carrier object\n */\nfunction hasHubOnCarrier(carrier: Carrier): boolean {\n  return !!(carrier && carrier.__SENTRY__ && carrier.__SENTRY__.hub);\n}\n\n/**\n * This will create a new {@link Hub} and add to the passed object on\n * __SENTRY__.hub.\n * @param carrier object\n * @hidden\n */\nexport function getHubFromCarrier(carrier: Carrier): Hub {\n  return getGlobalSingleton<Hub>('hub', () => new Hub(), carrier);\n}\n\n/**\n * This will set passed {@link Hub} on the passed object's __SENTRY__.hub attribute\n * @param carrier object\n * @param hub Hub\n * @returns A boolean indicating success or failure\n */\nexport function setHubOnCarrier(carrier: Carrier, hub: Hub): boolean {\n  if (!carrier) return false;\n  const __SENTRY__ = (carrier.__SENTRY__ = carrier.__SENTRY__ || {});\n  __SENTRY__.hub = hub;\n  return true;\n}\n"],"names":["SDK_VERSION","scope","Scope","uuid4","dateTimestampInSeconds","consoleSandbox","DEBUG_BUILD","logger","session","closeSession","DEFAULT_ENVIRONMENT","GLOBAL_OBJ","makeSession","updateSession","getGlobalSingleton"],"mappings":"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"}