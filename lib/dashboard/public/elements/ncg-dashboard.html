<link rel="import" href="/bower_components/app-layout/app-layout.html">
<link rel="import" href="/bower_components/app-layout/app-scroll-effects/app-scroll-effects.html">
<link rel="import" href="/bower_components/app-route/app-location.html">
<link rel="import" href="/bower_components/app-route/app-route.html">
<link rel="import" href="/bower_components/iron-flex-layout/iron-flex-layout-classes.html">
<link rel="import" href="/bower_components/iron-flex-layout/iron-flex-layout.html">
<link rel="import" href="/bower_components/iron-icons/av-icons.html">
<link rel="import" href="/bower_components/iron-icons/communication-icons.html">
<link rel="import" href="/bower_components/iron-icons/image-icons.html">
<link rel="import" href="/bower_components/iron-icons/iron-icons.html">
<link rel="import" href="/bower_components/iron-image/iron-image.html">
<link rel="import" href="/bower_components/iron-media-query/iron-media-query.html">
<link rel="import" href="/bower_components/iron-pages/iron-pages.html">
<link rel="import" href="/bower_components/iron-selector/iron-selector.html">
<link rel="import" href="/bower_components/paper-dialog-scrollable/paper-dialog-scrollable.html">
<link rel="import" href="/bower_components/paper-dialog/paper-dialog.html">
<link rel="import" href="/bower_components/paper-icon-button/paper-icon-button.html">
<link rel="import" href="/bower_components/paper-item/paper-icon-item.html">
<link rel="import" href="/bower_components/paper-spinner/paper-spinner.html">
<link rel="import" href="/bower_components/paper-tabs/paper-tabs.html">
<link rel="import" href="/bower_components/paper-toast/paper-toast.html">
<link rel="import" href="assets/ncg-assets.html">
<link rel="import" href="graphics/ncg-graphics.html">
<link rel="import" href="mixer/ncg-mixer.html">
<link rel="import" href="ncg-dashboard-panel.html">
<link rel="import" href="ncg-dialog.html">
<link rel="import" href="settings/ncg-settings.html">

<dom-module id="ncg-dashboard">
	<template>
		<style include="iron-flex iron-flex-alignment">
			:host {
				-webkit-tap-highlight-color: rgba(0, 0, 0, 0);
				overflow: hidden;
				@apply(--layout-fullbleed);
			}

			app-drawer-layout,
			app-header-layout {
				height: 100%;
			}

			app-header {
				background-color: rgb(255, 255, 255);
				--app-header-shadow: {
					box-shadow: inset 0px 5px 6px -3px rgba(0, 0, 0, 0.2);
					height: 10px;
					bottom: -10px;
				};
			}

			app-drawer {
				--app-drawer-content-container: {
					background-color: #f3f3f3;
				};
			}

			.spacer {
				@apply(--layout);
				@apply(--layout-flex-auto);
				@apply(--layout-center-center);
			}

			paper-tabs {
				height: 100%;
				@apply(--layout-horizontal);
				@apply(--layout-center);
				--paper-tabs-selection-bar-color: #00bebe;
				--paper-tabs-selection-bar: {
					border-bottom-width: 5px;
				};
			}

			paper-tab {
				font-size: 12px;
				text-transform: uppercase;
				user-select: none;

				@apply(--layout-flex-none);

				--paper-tab-ink: #00bebe;
				--paper-tab-content: {
					font-weight: 500!important; /* don't bold when focused */
					color: #00bebe;
				};
				--paper-tab-content-unselected: {
					color: black;
				};
			}

			paper-tab a {
				color: inherit;
				font-weight: inherit;
				@apply(--layout-vertical);
				@apply(--layout-center-center);
			}

			paper-icon-button {
				color: #000;
				--paper-icon-button-ink-color: #00bebe;
			}

			.logo {
				width: 48px;
				height: 48px;
			}

			#drawerToolbar {
				@apply(--layout-horizontal);
				@apply(--layout-center);
				@apply(--layout-justified);
			}

			.list {
				margin-left: 20px;
				margin-right: 20px;
			}

			.list a {
				display: block;
				line-height: 40px;
				text-decoration: none;
				text-transform: uppercase;
				color: #7c7c7c;
			}

			.list a.iron-selected {
				color: #00bebe;
			}

			.list a.iron-selected paper-icon-item {
				font-weight: bold;
			}

			iframe {
				width: 100%;
			}

			#loadingSpinner {
				position: fixed;
				top: 50%;
				left: 50%;
				transform: translate(-50%);
				width: 68px;
				height: 68px;
				--paper-spinner-stroke-width: 5px;
				--paper-spinner-layer-1-color: var(--nodecg-info-color);
				--paper-spinner-layer-2-color: var(--nodecg-configure-color);
				--paper-spinner-layer-3-color: var(--nodecg-success-color);
				--paper-spinner-layer-4-color: var(--nodecg-danger-color);
			}

			ncg-dialog paper-dialog-scrollable {
				--paper-dialog-scrollable: {
					max-width: none!important;
				}
			}

			#panels {
				width: 100%;
				height: 100%;
				transition: opacity 500ms ease, transform 600ms ease-out;
				opacity: 0;
				pointer-events: none;
				transform: translateY(40px);
				box-sizing: border-box;
			}

			section {
				box-sizing: border-box;
				@apply(--layout-vertical);
				@apply(--layout-flex);
				@apply(--layout-center);
			}

			#pages {
				overflow-y: auto;
				box-sizing: border-box;
				padding: 32px;
				@apply(--layout-vertical);
				@apply(--layout-flex-auto);
			}

			/**
			 * Narrow, but not quite phone narrow.
			 * TBH, this should probably be all just be one single breakpoint.
			 */
			@media (max-width: 640px) {
				#pages {
					padding: 0;
				}

				#panels {
					padding: 6px;
				}
			}

			/**
			 * Phone
			 */
			@media (max-width: 689px) {
				paper-tabs {
					display: none;
				}

				#mainToolbar .logo {
					/* makes the menu button have equal negative space on the left and the right */
					padding-left: 16px;
				}
			}
		</style>

		<app-location route="{{route}}" use-hash-as-path></app-location>
		<app-route
			route="{{route}}"
			pattern=":page"
			data="{{routeData}}"
			tail="{{subRoute}}"></app-route>

		<iron-media-query query="max-width: 689px" query-matches="{{smallScreen}}"></iron-media-query>

		<app-drawer-layout drawer-width="288px" force-narrow>
			<!-- navigation drawer for small screen sizes -->
			<app-drawer id="drawer" swipe-open="[[smallScreen]]">
				<template is="dom-if" if="[[smallScreen]]">
					<app-toolbar id="drawerToolbar">
						<paper-icon-button icon="close" aria-label="Close" drawer-toggle></paper-icon-button>
						<span>NodeCG</span>
						<img class="logo" src="/dashboard/img/square-logo.png">
					</app-toolbar>

					<iron-selector class="list" selected="[[routeData.page]]" attr-for-selected="data-route">
						<template is="dom-repeat" items="[[workspaces]]" as="workspace" initial-count="1">
							<a data-route$="[[workspace.route]]"
							   href="#[[workspace.route]]"
							   aria-label="[[workspace.name]]"
							   on-tap="closeDrawer">
								<paper-icon-item>
									<iron-icon item-icon icon="dashboard"></iron-icon>
									[[workspace.name]]
								</paper-icon-item>
							</a>
						</template>

						<template is="dom-repeat" items="[[pages]]" as="page" initial-count="1">
							<a data-route$="[[page.route]]"
							   href="#[[page.route]]"
							   aria-label="[[page.name]]"
							   on-tap="closeDrawer">
								<paper-icon-item>
									<iron-icon item-icon icon="[[page.icon]]"></iron-icon>
									[[page.name]]
								</paper-icon-item>
							</a>
						</template>
					</iron-selector>
				</template>
			</app-drawer>

			<app-header-layout>
				<!-- main header -->
				<app-header id="header" shadow>
					<app-toolbar id="mainToolbar">
						<paper-icon-button
							icon="menu"
							drawer-toggle
							alt="Toogle navigation menu"
							hidden="[[!smallScreen]]"></paper-icon-button>

						<img class="logo" src="/dashboard/img/square-logo.png">

						<template is="dom-if" if="[[!smallScreen]]">
							<paper-tabs
								class="spacer"
								scrollable
								selected="[[routeData.page]]"
								attr-for-selected="route">
								<template is="dom-repeat" items="[[workspaces]]" as="workspace">
									<paper-tab class="workspaceTab" route="[[workspace.route]]" aria-label="[[workspace.name]]">
										<a href="#[[workspace.route]]">[[workspace.name]]</a>
									</paper-tab>
								</template>
							</paper-tabs>

							<paper-tabs selected="[[routeData.page]]" attr-for-selected="route">
								<template is="dom-repeat" items="[[pages]]" as="page" initial-count="1">
									<paper-tab route="[[page.route]]" aria-label="[[page.name]]">
										<a href="#[[page.route]]">
											<iron-icon item-icon icon="[[page.icon]]"></iron-icon>
											[[page.name]]
										</a>
									</paper-tab>
								</template>

								<paper-tab hidden="[[loginDisabled]]" aria-label="Sign Out">
									<a href="/logout" on-tap="logout">
										<iron-icon item-icon icon="exit-to-app"></iron-icon>
										Sign Out
									</a>
								</paper-tab>
							</paper-tabs>
						</template>
					</app-toolbar>
				</app-header>

				<iron-pages id="pages" selected="[[route.path]]" attr-for-selected="route">
					<section route="">
						<div id="panels" on-tap="shiftPackery">
							<template is="dom-repeat" items="[[panels]]" as="panel">
								<ncg-dashboard-panel
									id="[[panel.bundleName]]_[[panel.name]]"
									display-title="[[panel.title]]"
									bundle="[[panel.bundleName]]"
									panel="[[panel.name]]"
									header-color="[[panel.headerColor]]"
									width="[[panel.width]]">
									<iframe
										src="/panel/[[panel.bundleName]]/[[panel.file]]"
										frameborder="0"
										scrolling="no">
									</iframe>
								</ncg-dashboard-panel>
							</template>
						</div>

						<paper-spinner id="loadingSpinner" active></paper-spinner>
					</section>

					<section route="graphics">
						<ncg-graphics></ncg-graphics>
					</section>

					<section route="mixer">
						<ncg-mixer></ncg-mixer>
					</section>

					<section route="assets">
						<ncg-assets></ncg-assets>
					</section>

					<section route="settings">
						<ncg-settings></ncg-settings>
					</section>

					<slot></slot>
				</iron-pages>

			</app-header-layout>
		</app-drawer-layout>

		<div id="dialogs">
			<template is="dom-repeat" items="[[dialogs]]" as="dialog">
				<ncg-dialog
					id="[[dialog.bundleName]]_[[dialog.name]]"
					bundle="[[dialog.bundleName]]"
					panel="[[dialog.name]]"
					width="[[dialog.width]]"
					with-backdrop>
					<template is="dom-if" if="[[dialog.title]]">
						<h2>[[dialog.title]]</h2>
					</template>

					<template is="dom-if" if="[[dialog.dialogButtons]]">
						<div class="buttons">
							<template is="dom-repeat" items="[[dialog.dialogButtons]]" as="button">
								<paper-button
									dialog-confirm$="[[_equal(button.type, 'confirm')]]"
									dialog-dismiss$="[[_equal(button.type, 'dismiss')]]">
									[[button.name]]
								</paper-button>
							</template>
						</div>
					</template>

					<paper-dialog-scrollable>
						<iframe
							src="/panel/[[dialog.bundleName]]/[[dialog.file]]"
							frameborder="0"
							scrolling="no">
						</iframe>
					</paper-dialog-scrollable>
				</ncg-dialog>
			</template>
		</div>

		<paper-toast id="mainToast"></paper-toast>
	</template>

	<script src="ncg-dashboard.js"></script>
</dom-module>
